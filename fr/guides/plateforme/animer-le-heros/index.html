<!DOCTYPE html>
<html>
  <head>
    <title>Atelier jeux HTML5 - Animer le héros</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="stylesheet" href="../../../../css/styles.css"/>
    <link rel="stylesheet" href="../../../../vendor/prism/prism.css"/>
    <script src="../../../../vendor/prism/prism.js"></script>
  </head>
  <body>
    <header class="main-header">
      <h1><a href="../../..">Atelier jeux HTML5</a></h1>
    </header>
    <main>
      <article>
        <p>Également disponible en <a href="../../../../en/guides/platformer/animations-for-the-main-character">en</a>.
        </p>
        <h1>Animer le héros</h1><p>Pour le moment, il y a peu de sprites animés dans le jeu : les pièces et les ennemis. Mais rien pour le héros!</p>
<p>Voici la feuille de sprite et les animations liées.</p>
<p><img src="/html5-games-workshop/assets/platformer/hero_spritesheet.png" alt="Main character spritesheet"/></p>
<ul>
<li>À l&#39;arrêt, image 0</li>
<li>En course, images 1 et 2</li>
<li>En Saut, image 3</li>
<li>En Chute, image 4.</li>
</ul>
<p><small>Les images liées au décès du héros seront utilisées à l&#39;étape suivante.</small></p>
<p>L&#39;approche utilisée pour gérer ceci est de vérifier à <strong>chaque image</strong> l&#39;état du héros et choisir l&#39;animation correspondante.</p>
<h1 id="t-ches">Tâches</h1>
<h2 id="ajout-des-animations">Ajout des animations</h2>
<ol>
<li><p>Auparavant nous utilisions l&#39;image <code>hero_stopped.png</code> en tant qu&#39;image. Il nous faut supprimer cette ligne.</p>
<pre><code class="lang-js"> PlayState.preload = function () {
     //this.game.load.image(&#39;hero&#39;, &#39;images/hero_stopped.png&#39;);
 };
</code></pre>
</li>
<li><p>Et charger la feuille de sprites à la place. De taille <code>36×42</code>.</p>
<pre><code class="lang-js"> PlayState.preload = function () {
     // ...
     this.game.load.spritesheet(&#39;hero&#39;, &#39;images/hero.png&#39;, 36, 42);
     // ...
 };
</code></pre>
</li>
<li><p>Dans le constructeur du héros, nous pouvons ajouter les animations telles que décrites ci-dessus.</p>
<pre><code class="lang-js"> function Hero(game, x, y) {
     // ...
     this.animations.add(&#39;stop&#39;, [0]);
     this.animations.add(&#39;run&#39;, [1, 2], 8, true); // 8fps en boucle
     this.animations.add(&#39;jump&#39;, [3]);
     this.animations.add(&#39;fall&#39;, [4]);
 }
</code></pre>
</li>
</ol>
<h2 id="choix-de-l-animation-en-cours">Choix de l&#39;animation en cours</h2>
<ol>
<li><p>Calculer quelle animation doit être jouée. Une nouvelle méthode du héros va retourner le nom d&#39;animation.</p>
<pre><code class="lang-js"> Hero.prototype.getAnimationName = function () {
     if (this.body.velocity.y &lt; 0) {
         return &#39;jump&#39;;
     }

     if (this.body.velocity.y &gt;= 0 &amp;&amp; !this.body.touching.down) {
         return &#39;fall&#39;;
     }

     if (this.body.velocity.x !== 0 &amp;&amp; this.body.touching.down) {
         return &#39;run&#39;;
     }

     return &#39;stop&#39;
 };
</code></pre>
<p> Notons qu&#39;il faut vérifier si le héros touche ou non le sol. En raison de la <strong>force de gravité</strong>, le héros possède une vitesse verticale même sans qu&#39;il ne bouge.</p>
</li>
<li><p>La méthode mise-à-jour <code>update</code> du héros va jouer l&#39;animation voulue. Phaser gère pour nous le fait de savoir si l&#39;animation doit être modifiée ou si l&#39;animation en cours persiste.</p>
<pre><code class="lang-js"> Hero.prototype.update = function () {
     var animationName = this.getAnimationName();
     this.animations.play(animationName);
 };
</code></pre>
</li>
<li><p>Essayons dans le navigateur! Courrons, sautons, etc. Les animations doivent changer. Mais, reste un petit problème, le héros de se tourne pas à gauche et fait un petit <em>moon-walk</em>.</p>
<p> <img src="/html5-games-workshop/assets/platformer/hero_animation_glitch.gif" alt="Animations… with a glitch!"/></p>
</li>
</ol>
<h2 id="tourner-le-caract-re-dans-la-bonne-direction">Tourner le caractère dans la bonne direction</h2>
<ol>
<li><p>Aussi bizarre que celà puisse paraître, retourner une image se fait en appliquant un zoom négatif sur une image. Un zoom de <code>-100%</code> va créer un miroir horizontal et faire que le héros regarde à gauche.</p>
<p> Ajouter ceci à la méthode déplacer <code>move</code> puisse que la direction est connu à ce moment-là.</p>
<pre><code class="lang-js"> Hero.prototype.move = function (direction) {
     // ...
     if (this.body.velocity.x &lt; 0) {
         this.scale.x = -1;
     }
     else if (this.body.velocity.x &gt; 0) {
         this.scale.x = 1;
     }
 };
</code></pre>
</li>
</ol>
<p>Et voilà, le héros se déplace et s&#39;anime correctement.</p>
<p><img src="/html5-games-workshop/assets/platformer/hero_animations.gif" alt="Main character, properly animated"/></p>
<h1 id="v-rification">Vérification</h1>
<ul>
<li>Le héros utilise des animations différentes ou images pour les actions à l&#39;arrêt, course, saut et chute.</li>
<li>Le héros s&#39;oriente dans la direction de déplacement.</li>
</ul>

        <h2>Téléchargement</h2>
        <p>Êtes-vous bloqué? Jetez un œil <a href="../../../../assets/platformer/steps/step13.js" télécharger="">au code source</a> de cette étape.
        </p>
        <nav class="paginated-nav">
          <ul>
            <li class="previous">« Prédédent:&nbsp;<a href="../tableau-des-scores">Tableau des scores</a></li>
            <li class="next">Suivant:&nbsp;<a href="../fin-de-partie">Fin de partie</a>&nbsp;»</li>
          </ul>
        </nav>
      </article>
    </main>
    <footer class="main-footer">
      <p>Propulsé avec amour,<br/>par les fées de chez <a href="https://mozilla.org">Mozilla</a>.</p>
    </footer>
  </body>
</html>