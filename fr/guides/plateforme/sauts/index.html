<!DOCTYPE html>
<html>
  <head>
    <title>Atelier jeux HTML5 - Sauts</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="stylesheet" href="../../../../css/styles.css"/>
    <link rel="stylesheet" href="../../../../vendor/prism/prism.css"/>
    <script src="../../../../vendor/prism/prism.js"></script>
  </head>
  <body>
    <header class="main-header">
      <h1><a href="../../..">Atelier jeux HTML5</a></h1>
    </header>
    <main>
      <article>
        <p>Également disponible en <a href="../../../../en/guides/platformer/jumps">en</a>.
        </p>
        <h1>Sauts</h1><p>La gravité en place, il est quasiment trivial de gérer le saut du héros. En cours de physique, vous avez peut-être vu qu&#39;un mouvement uniformément accéléré, tel que celui donc l&#39;accéleration est une force de gravité, produit un mouvement parabolique.</p>
<p>À la pression de la touche flèche haut, le héros a sauter en lui donnant une vitesse verticale. Nous allons également jouer un jon quand ceci se produit. Dans un jeu, le son est critique pour fournir un retour à la joueuse ou au joueur.</p>
<h1 id="t-ches">Tâches</h1>
<h2 id="d-tecter-la-touche-fl-che-haut">Détecter la touche flèche haut</h2>
<ol>
<li><p>Comme pour les touches gauche et droite, nous ajoutons la touche flèche haut.</p>
<pre><code class="lang-js"> PlayState.init = function () {
     // ...
     this.keys = this.game.input.keyboard.addKeys({
         left: Phaser.KeyCode.LEFT,
         right: Phaser.KeyCode.RIGHT,
         up: Phaser.KeyCode.UP
     });
 };
</code></pre>
</li>
<li><p>Auparavant, nous vérifions l&#39;état d&#39;une touche lors de la mise à jour <code>update</code>. Pour le saut, nous allons utiliser une solution alternative. Il est possible d&#39;effectuer une action au moment où la touche est pressée.</p>
<pre><code class="lang-js"> this.keys.up.onDown.add(function () {
     this.hero.jump();
 }, this);
</code></pre>
</li>
</ol>
<p><small>L&#39;argument supplémentaire donné au <code>add</code>, ici <code>this</code> sert à donner un contexte à la fonction créée. Une spécialité liée au fonctionnement de JavaScript.</small></p>
<h2 id="r-aliser-la-m-thode-de-saut">Réaliser la méthode de saut</h2>
<ol>
<li><p>La méthode sauter <code>jump</code> peut être ajoutée à notre héros.</p>
<pre><code class="lang-js"> Hero.prototype.JUMP_SPEED = 600;

 Hero.prototype.jump = function () {
     this.body.velocity.y = -this.JUMP_SPEED;
 };
</code></pre>
</li>
<li><p>Essayez dans le navigateur! Il saute. Mais il saute également en l&#39;air, comme s&#39;il savait voler. Cependant, si vous êtes un·e joueu·r.se aguéri, le double-saut ne vous est pas forcément inconnu.</p>
</li>
<li><p>Nous allons imposer au héros un seul saut. Le moteur physique gérant les collisions peut nous informer des collisions en cours de notre objet. Tester la collision avec le sol implique qu&#39;on peut sauter.</p>
<pre><code class="lang-js"> Hero.prototype.jump = function () {
     let canJump = this.body.touching.down;

     if (canJump) {
         this.body.velocity.y = -this.JUMP_SPEED;
     }

     return canJump;
 };
</code></pre>
</li>
</ol>
<p><small>Savoir si le saut a été possible, nous permettra de jouer un saut par la suite.</small></p>
<h2 id="jouer-un-son-au-saut">Jouer un son au saut</h2>
<ol>
<li><p>Les sons sont des assets du jeu comme les autres, qu&#39;il faut précharger.</p>
<pre><code class="lang-js"> PlayState.preload = function () {
     // ...
     this.game.load.audio(&#39;sfx:jump&#39;, &#39;audio/jump.wav&#39;);
 };
</code></pre>
</li>
<li><p>La phase de création va créer l&#39;instance d&#39;un son <code>Phaser.Sound</code> dans notre jeu. Un son se crée de la même manière qu&#39;une image mais via la fonction <code>audio</code>.</p>
<pre><code class="lang-js"> PlayState.create = function () {
     // ...
     this.sfx = {
         jump: this.game.add.audio(&#39;sfx:jump&#39;)
     };
 };
</code></pre>
</li>
<li><p>Et finalement, jouons un saut lorsqu&#39;un saut est fait en adaptant la fonction de la touche.</p>
<pre><code class="lang-js"> PlayState.init = function () {
     // ...
     this.keys.up.onDown.add(function () {
         let didJump = this.hero.jump();
         if (didJump) {
             this.sfx.jump.play();
         }
     }, this);
 };
</code></pre>
</li>
</ol>
<p>Et voilà, le héros se déplace et avec un peu d&#39;entrainement, il sera possible d&#39;atteindre toutes les plateformes.</p>
<p><img src="/html5-games-workshop/assets/platformer/hero_jump.gif" alt="Main character jumping"/></p>
<h1 id="v-rifications">Vérifications</h1>
<ul>
<li>Le héros saute!</li>
<li>Il ne peut pas sauter sans être sur une plateforme.</li>
<li>Un son est joué au saut.</li>
</ul>

        <h2>Téléchargement</h2>
        <p>Êtes-vous bloqué? Jetez un œil <a href="../../../../assets/platformer/steps/step08.js" télécharger="">au code source</a> de cette étape.
        </p>
        <nav class="paginated-nav">
          <ul>
            <li class="previous">« Prédédent:&nbsp;<a href="../gravitation">Gravitation</a></li>
            <li class="next">Suivant:&nbsp;<a href="../passe-la-monnaie">Passe la monnaie</a>&nbsp;»</li>
          </ul>
        </nav>
      </article>
    </main>
    <footer class="main-footer">
      <p>Propulsé avec amour,<br/>par les fées de chez <a href="https://mozilla.org">Mozilla</a>.</p>
    </footer>
  </body>
</html>