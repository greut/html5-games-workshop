<!DOCTYPE html>
<html>
  <head>
    <title>Atelier jeux HTML5 - Changer de niveau</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="stylesheet" href="../../../../css/styles.css"/>
    <link rel="stylesheet" href="../../../../vendor/prism/prism.css"/>
    <script src="../../../../vendor/prism/prism.js"></script>
  </head>
  <body>
    <header class="main-header">
      <h1><a href="../../..">Atelier jeux HTML5</a></h1>
    </header>
    <main>
      <article>
        <p>Également disponible en <a href="../../../../en/guides/platformer/switching-levels">en</a>.
        </p>
        <h1>Changer de niveau</h1><p>Nous avons les conditions de la victoire mais redémarrons le même niveau. Peu intéressant. Dans le répetoire <code>data</code>, il y a deux niveaux: <code>level00.json</code> et <code>level01.json</code>. Utilisons-les!</p>
<p>Le jeu va commencer avec le niveau zéro puis passer au niveau un.</p>
<p>À la fin du niveau deux, nous recommencerons au début, mais rien n&#39;empêche de créer de nouveaux univers.</p>
<p>Un moyen de passer d&#39;un niveau à l&#39;autre et de donner le niveau en cours à l&#39;état du jeu <code>PlayState</code>. Nous allons passer des paramètres à <code>init</code>.</p>
<h1 id="t-ches">Tâches</h1>
<h2 id="chargement-de-tous-les-niveaux">Chargement de tous les niveaux</h2>
<ol>
<li><p>Ajoutons le niveau zéro dans les fichiers à précharger.</p>
<pre><code class="lang-js"> PlayState.preload = function () {
     this.game.load.json(&#39;level:0&#39;, &#39;data/level00.json&#39;);
     // ...
 };
</code></pre>
</li>
<li><p>Au démarrage de l&#39;état <code>init</code>, la propriété niveau <code>level</code> contiendra le niveau en cours.</p>
<pre><code class="lang-js"> PlayState.init = function (data) {
     // ...
     this.level = (data.level || 0) % 2;
 };
</code></pre>
<p> Notez que <code>% 2</code> est nécessaire pour retourner à zéro si la valeur dépassait 2. Et le <code>|| 0</code> est la syntaxe utilisée en JavaScript pour définir une valeur par défaut.</p>
</li>
<li><p>À la création du niveau <code>create</code>, la propriété niveau va permettre de charger le niveau en cours.</p>
<pre><code class="lang-js"> PlayState.create = function () {
     // ...
     this.loadLevel(this.game.cache.getJSON(&quot;level:&quot; + this.level));
     // ...
 };
</code></pre>
</li>
<li><p>Maintenant, il suffit de donner le niveau en cours à <code>init</code> à la création.</p>
</li>
</ol>
<pre><code>```js
window.onload = function () {
    // ...
    // change the line below for the new one!
    // game.state.start(&#39;play&#39;);
    game.state.start(&#39;play&#39;, true, false, {level: 0});
};
```

Le premier `true` indique à Phaser de conserver le cache. Et le second `false` indique de ne pas conserver les éléments existant. Il supprime touts les sprites, textes, groupes, etc. Ce sont les valeurs par défaut.
</code></pre><ol>
<li><p>Essayons, le niveau zéro doit s&#39;afficher.</p>
<p> <img src="/html5-games-workshop/assets/platformer/level00_thumb.png" alt="The first level"/></p>
</li>
</ol>
<h2 id="changer-de-niveau">Changer de niveau</h2>
<ol>
<li><p><code>init</code> demande un argument contenant le niveau, il faut donc le lui donner au redémarrage <code>restart</code>.</p>
<pre><code class="lang-js"> PlayState.onHeroVsDoor = function (hero, door) {
     // ...
     this.game.state.restart(true, false, { level: this.level + 1 });
 };
</code></pre>
</li>
<li><p>Et également quand le héros décède mais sans passer au niveau suivant.</p>
<pre><code class="lang-js"> PlayState._onHeroVsEnemy = function (hero, enemy) {
     // ...
     else {
         // ...
         this.game.state.restart(true, false, {level: this.level});
     }
 };
</code></pre>
</li>
</ol>
<p>Et voilà, il doit être possible de jouer aux deux univers.</p>
<h1 id="v-rifications">Vérifications</h1>
<ul>
<li>Le jeu débute au niveau zéro</li>
<li>Passer la porte change de niveau</li>
<li>À la fin, on recommence au niveau zéro</li>
<li>Quand le héros décède, le niveau actuel recommence.</li>
</ul>

        <h2>Téléchargement</h2>
        <p>Êtes-vous bloqué? Jetez un œil <a href="../../../../assets/platformer/steps/step15.js" télécharger="">au code source</a> de cette étape.
        </p>
        <nav class="paginated-nav">
          <ul>
            <li class="previous">« Prédédent:&nbsp;<a href="../fin-de-partie">Fin de partie</a></li>
            <li class="next">Suivant:&nbsp;<a href="../aller-plus-loin">Aller plus loin…</a>&nbsp;»</li>
          </ul>
        </nav>
      </article>
    </main>
    <footer class="main-footer">
      <p>Propulsé avec amour,<br/>par les fées de chez <a href="https://mozilla.org">Mozilla</a>.</p>
    </footer>
  </body>
</html>